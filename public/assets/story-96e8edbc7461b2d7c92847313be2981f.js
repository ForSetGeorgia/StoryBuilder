function mobileReorient(){var e=window.innerHeight-40;e>720*.59&&window.innerWidth<768&&(e=720*.59);var t=document.querySelector(".video-sequence");null!==t&&t.length&&(t.querySelector(".video:first-of-type .video-container")[0].style.height=e+"px",t.querySelector(".video:first-of-type .video-headline")[0].style.height=e+"px")}var isMobile=function(){return/iPad|iPod|iPhone|Android/.test(navigator.userAgent)||"#ipad"==document.location.hash},isPhone=function(){return isMobile()&&window.innerWidth<768};isMobile()&&(document.documentElement.className=document.documentElement.className+" ios mob"),function(){var e=[];defer=function(t){e.push(t)},await=function(){e.forEach(function(e){e()})}}(),isMobile()&&(mobileReorient(),defer(function(){if(!isMobile())return!1;var e=path.fullscreen.other.image,t=path.slideshow.other.image,n=path.fullscreen.desktop.video,i=path.fullscreen.desktop.poster;isPhone()&&(e=e.replace("mobile_1024","mobile_640"),t=t.replace("mobile_1024","mobile_640")),d3.select(window).on("resize",mobileReorient).on("scroll",function(){d3.select(".navigation").classed("navigation-solid",window.scrollY>350)}),d3.select(".video-sequence:first-of-type").classed("ios-loaded",!0),setTimeout(function(){var o=d3.selectAll(".section.video-sequence .video").datum(function(){return{video:this.getAttribute("data-video"),image:this.getAttribute("data-image")}}),a=o.select(".video-container").filter(function(e){return e.video});a.selectAll(".temporary").remove();var r=a.insert("video",":first-child").attr("preload","none").attr("poster",function(e){return i+e.video+".jpg"}).property("loop",!1).property("controls",!0).text("Your browser does not support this video.");r.append("source").attr("src",function(e){return n+e.video+".mp4"}).attr("type","video/mp4");var r=o.select(".video-container").filter(function(e){return e.image}).select(".re-aspect").attr("src",function(t){return e+t.image});String.prototype.trim||(String.prototype.trim=function(e){var t=e?new RegExp("^"+e+"+|"+e+"+$","g"):new RegExp("^\\s+|\\s+$","g");return this.replace(t,"")}),d3.selectAll(".slideshow").each(function(){var e=d3.select(this).select(".container"),n=e.select(".captions");n.selectAll(".caption").each(function(){var e=this;""==d3.select(e).text().trim()&&d3.select(e).classed("empty",!0),n.insert("div",function(){return e}).classed("image",!0).append("img").attr("src",function(){return t+e.getAttribute("data-image")})}),e.insert(function(){return e.select(".description").remove()[0][0]},".captions")})},200)})),defer(function(){function e(){T.attr("preload",function(e){return e.first?"auto":"none"})}function t(){u=!u,p=u?"_volume":"volume",N.classed("navigation-volume--muted",u),d3.event.preventDefault(),d3.selectAll("audio,video").interrupt().property("volume",u?function(){return this._volume=this.volume,0}:function(){return this._volume})}function n(){h=innerWidth/innerHeight,f=innerWidth/h,m=Math.round((innerHeight-f)/2),g=Math.max(200,m),y=Math.min(innerHeight-200,m+f),d3.select(".video-sequence:first-child").style("margin-top",m+"px"),E.style("height",innerHeight+"px").filter(function(e){var t=this.parentNode.getBoundingClientRect();return e.first?t.top<m:!e.last||t.bottom>=m+f}).style("top","0px"),x.style("height",innerHeight+"px"),d3.selectAll(".infographic iframe.height").attr("height",innerHeight),d3.selectAll(".infographic .interactive-iframe-popup iframe.height").attr("height",innerHeight-80)}function i(e){if(e.first||e.last){
//!(d.first && d.last) && () for bug when media section has only one media
var t=!(e.first&&e.last)&&(e.first&&d3.event.rect.top<0||e.last&&d3.event.rect.bottom>=0+f);d3.select(this.querySelector(".video-container")).style("z-index",t?2:1).style("top",t?"0px":null).style("position",t?"fixed":"absolute")}var n=d3.select(this),i=n.select(".video-container"),o=this.querySelector(".video-container video"),a=1,r=d3.event.rect.top-f/4,s=r>m+4*f/5?0:!e.last&&r<m-f?0:r<m?1:Math.max(0,Math.min(1,1-(r-m)/(f/5)));if(e.first){if(o){a=d3.event.rect.top<m+g?Math.max(0,Math.min(1,1-(d3.event.rect.top-m)/g)):0;var l=d3.event.rect.top<=m+g;o.paused?l&&(!e.animation||o.currentTime<o.duration&&a>.8)&&o.play():l||o.pause()}i.style("opacity",r>=m-f?1:0)}else i.style("opacity",s),o&&(o.paused?s?(!e.animation||o.currentTime<o.duration&&s>.8)&&o.play():o.currentTime&&(o.currentTime=0):s||(o.pause(),o.currentTime&&(o.currentTime=0)));if(e.last&&o){a=d3.event.rect.bottom<y?Math.max(0,Math.min(1,1-(y-d3.event.rect.bottom)/g)):1;var l=d3.event.rect.bottom>=y-g;o.paused?l&&(!e.animation||o.currentTime<o.duration&&a>.8)&&o.play():l||o.pause()}n.select(".video-caption").style("opacity",r>m?e.first?1:Math.max(0,1-(r-m)/(f/5)):r>m-4*f/5?1:e.last?1:Math.max(0,(r-m+4*f/5)/(f/5)+1)),o&&(o[p]=a=1!==a?a:r<m-f?0:r<m-f/2?Math.max(0,Math.min(1,(r-m+f)/(f/2))):s,e.first&&e.sequence.first&&b.style("opacity",1==a?1:a-.7>0?a-.7:0))}function o(e){d3.select(this.querySelector(".video-container")).style("display",d3.event.state?null:"none").select("video").each(function(){d3.event.state||(this.paused||this.pause(),this.currentTime&&(this.currentTime=0))}),e.first&&e.sequence.first&&!d3.event.state&&b.style("opacity",1)}function a(){var e=Math.max(0,Math.min(1,d3.event.rect.bottom<y?(y-d3.event.rect.bottom)/g:d3.event.rect.top<m+g?(d3.event.rect.top-m)/g:1));d3.select(this).classed("column")||d3.select("body").style("background",_(e)),d3.select(this).select("audio").property(p,1-e)}function r(){var e=d3.select(this),t=e.select("audio");d3.event.state?(e.selectAll("video").each(function(){this.preload="auto"}),t.each(function(){this.play()})):(d3.select("body").style("background",null),t.each(function(){this.pause()}))}function s(){var e=d3.select("body").append("div").style("width","50vw"),t=innerWidth/2,n=parseFloat(e.style("width"));return e.remove(),Math.abs(t-n)<=1}if(isMobile())return!1;var l=path.fullscreen.desktop.video,c=path.fullscreen.desktop.poster,d=path.fullscreen.desktop.audio,u=!1,p="volume",h=innerWidth/innerHeight,f=innerWidth/h,m=Math.round((innerHeight-f)/2),g=Math.max(200,m),y=Math.min(innerHeight-200,m+f),_=d3.interpolateRgb("#000","#fff"),b=d3.select(".scroll-prompt"),v=d3.selectAll(".video-sequence").datum(function(){return{first:!this.previousElementSibling,audio:this.getAttribute("data-audio"),length:this.querySelectorAll(".video").length}}).call(d3.behavior.watch().on("scroll",a).on("statechange",r));v.filter(function(e){return e.audio}).append("audio").attr("src",function(e){return d+e.audio+".mp3"}).property("loop",!0);var w=d3.selectAll(".section:not(.video-sequence)[data-audio]").datum(function(){return{audio:this.getAttribute("data-audio")}}).call(d3.behavior.watch().on("scroll",a).on("statechange",r));w.filter(function(e){return e.audio}).append("audio").attr("src",function(e){return d+e.audio+".mp3"}).property("loop",!0);var k=d3.selectAll(".video").datum(function(){var e=this.previousElementSibling,t=this.nextElementSibling;return{video:this.getAttribute("data-video"),animation:this.hasAttribute("data-animation"),loop:this.hasAttribute("data-videoloop"),first:!e||!d3.select(e).classed("video"),last:!t||!d3.select(t).classed("video")}}),x=v.selectAll(".video").each(function(e){e.sequence=this.parentNode.__data__}).call(d3.behavior.watch().on("scroll",i).on("statechange",o)),C=k.select(".video-container"),S=C.filter(function(e){return e.video});S.selectAll(".temporary").remove();var T=S.insert("video",":first-child").attr("preload","none").attr("poster",function(e){return c+e.video+".jpg"}).property("loop",function(e){return!e.animation}).property("loop",function(e){return e.loop}).text("Your browser does not support this video.");T.append("source").attr("src",function(e){return l+e.video+".mp4"}).attr("type","video/mp4"),s()||x.append("div").style("height",f+"px");var E=x.select(".video-container").style("z-index",function(e){return e.first||e.last?1:2}).style("position",function(e){return e.first||e.last?"absolute":"fixed"}).style("top",function(e){return e.first||e.last?null:"0px"}).style("display",function(e){return e.first||e.last?null:"none"});E.select(function(e){return e.sequence.length>1?this:null}).append("div").attr("class","video-sequence-indicator").style("margin-top",function(e){return 1.4*-e.sequence.length/2+"em"}).text(function(e,t){return d3.range(e.sequence.length).map(function(e){return t===e?"\u25cf":"\u25cb"}).join("\n")});var N=d3.select(".navigation-volume").on("click",t);d3.select(window).on("load.video",e).on("resize.video",n),d3.select("video").attr("preload","auto"),n()}),isMobile()||defer(function(){function e(){this.parentNode.appendChild(this)}var t=path.slideshow.desktop.image,n=path.slideshow.desktop.thumb;d3.selectAll(".slideshow").each(function(){function i(){d3.event.state&&(_.attr("src",function(e){return t+e.image}),p.on("statechange.first",null))}function o(){d3.event.state?a():r()}function a(){d||(d=setInterval(l,7e3))}function r(){d&&(d=clearInterval(d))}function s(t){var n=d3.select(_[0][u]),i=d3.select(f[0][u]),o=d3.select(b[0][u]),a=d3.select(_[0][t]),r=d3.select(f[0][t]),s=d3.select(b[0][t]);n.classed("active",!1),i.classed("active",!1),o.classed("active",!1),a.classed("active",!0).style("opacity",0).each(e),r.classed("active",!0),s.classed("active",!0),u=t,d3.timer(function(){a.style("opacity",null)},20)}function l(){s((u+1)%g)}function c(){s((u?u:g)-1)}var d,u=0,p=d3.behavior.watch().on("statechange.first",i).on("statechange",o),h=d3.select(this).select(".container").on("mouseover",r).on("mouseout",r).call(p),f=h.select(".captions").selectAll(".caption").datum(function(){return{image:this.getAttribute("data-image"),aspect_ratio_class:this.getAttribute("data-aspect")}}).classed("active",function(e,t){return t===u}),m=f.data(),g=m.length,y=h.insert("div",".captions").attr("class","inner-container"),_=y.append("div").attr("class","images").selectAll(".image").data(m).enter().append("img").attr("class",function(e){return"image "+e.aspect_ratio_class});_.filter(function(e,t){return t===u}).classed("active",!0).attr("src",function(e){return t+e.image}).each(e),y.append("div").attr("class","btn btn-next").on("click",function(){r(),l()}).html("<svg class='arrow' width='45' height='59' viewBox='-13 -21 45 59'><path d='M3,1.008L20.742,9.045L3,17.083L6,8.917Z'></path></svg>"),y.append("div").attr("class","btn btn-prev").on("click",function(){r(),c()}).html("<svg class='arrow' width='45' height='59' viewBox='-13 -21 45 59'><path d='M18.742,0.758L1,8.795L18.742,16.833L15.742,8.667Z'></path></svg>");var b=y.insert("div",".captions").attr("class","thumbs").selectAll(".thumb").data(m).enter().append("img").classed("thumb",!0).classed("active",function(e,t){return t===u}).attr("src",function(e){return n+e.image}).on("click",function(e,t){r(),s(t)})})}),function(){function e(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=t/e;d3.selectAll(".re-aspect").each(function(){var e=d3.select(this),t=+e.attr("data-aspectratio"),i=n>t;e.classed("ver",i).classed("hor",!i)}),d3.selectAll(".section.section-fullscreen .container > *:first-child").style("height",e+"px")}function t(){a.forEach(function(e){var t=e.element.getBoundingClientRect();if(t.top+t.height<0||t.bottom-t.height-innerHeight>0)i(e,0);else{var n=t.top/(innerHeight-t.height);i(e,n<0||n>1?1:2),o(e,{type:"scroll",offset:n,rect:t})}})}function n(){a.forEach(function(e){i(e,1),o(e,{type:"scroll",offset:.5,rect:{top:0}})})}function i(e,t){var n=e.state;n!==t&&o(e,{type:"statechange",state:e.state=t,previousState:n})}function o(e,t){var n=e.element,i=t.sourceEvent=d3.event;try{d3.event=t,e.event[t.type].call(n,n.__data__,e.index)}finally{d3.event=i}}var a=[];d3.behavior.watch=function(){function e(e){e.each(function(e){a.push({element:this,state:0,index:e,event:t})})}var t=d3.dispatch("statechange","scroll");return d3.rebind(e,t,"on")},/iPhone|iPad|iPad|Android/.test(navigator.userAgent)||"#ipad"==location.hash?d3.select(window).on("resize.watch",n).on("DOMContentLoaded.watch",n):d3.select(window).on("resize.watch",t).on("scroll.watch",t).on("DOMContentLoaded.watch",t),d3.select(window).on("resize.reheight",e),await(),e()}();