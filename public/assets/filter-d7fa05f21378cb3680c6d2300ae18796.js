function filter(){if(JSON.stringify(f)!==JSON.stringify(pf)){var e={};paging||(f.page="");for(prop in f){var t=prop,i=f[prop];f.hasOwnProperty(prop)&&"undefined"!=typeof i&&null!==i&&""!==i&&(e[t]=i)}paging||grid.html(""),grid_wrapper.find(".loading").length||grid_wrapper.append('<div class="loading"></div>'),paging||grid_wrapper.find(".loading").addClass("space"),$.ajax({type:"POST",url:gon.filter_path,dataType:"json",data:e}).done(function(e){setTimeout(function(){e=$(e.d);var t=e.find(".grid .col").length;grid_wrapper.find(".loading").remove(),e.find(".grid .col").each(function(e,i){setTimeout(function(){grid.append($(i).hide().fadeIn(2e3)),e==t-1&&(paging=!1)},300*e)}),0==t&&grid.append(e.find("p").hide().fadeIn(2e3)),grid_wrapper.find(".pagination-wrapper").html(e.find(".pagination-wrapper").html()),url_update()},1e3)})}}function url_update(){var e=window.location.href;for(prop in f)if(f.hasOwnProperty(prop)&&"page"!=prop){var t=prop,i=f[prop],n=new RegExp("([?&])"+t+"=.*?(&|#|$)(.*)","gi");if(n.test(e))if("undefined"!=typeof i&&null!==i&&""!==i)e=e.replace(n,"$1"+t+"="+i+"$2$3");else{var o=e.split("#");e=o[0].replace(n,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof o[1]&&null!==o[1]&&(e+="#"+o[1])}else if("undefined"!=typeof i&&null!==i&&""!==i){var a=e.indexOf("?")!==-1?"&":"?",o=e.split("#");e=o[0]+a+t+"="+i,"undefined"!=typeof o[1]&&null!==o[1]&&(e+="#"+o[1])}}e!=window.location&&window.history.pushState({path:e},"",e)}var sa=!1,f={page:""},pf={},paging=!1,grid_wrapper=$(".grid-wrapper"),grid=grid_wrapper.find(".grid");$(document).ready(function(){gon.page_filtered&&scrolldown(!1,"header"),$("[data-filter-type]").each(function(){f[$(this).attr("data-filter-type")]=$(this).attr("data-filtered-by")}),$(".afilter > a.not_published").click(function(e){pf=JSON.parse(JSON.stringify(f)),$(this).toggleClass("active");var t=!("true"==$(this).attr("data-filtered-by"));$(this).attr("data-filtered-by",t.toString()),f[$(this).attr("data-filter-type")]=t.toString(),t?$(this).attr("title",$(this).data("title-active")):$(this).attr("title",$(this).data("title")),e.preventDefault(),e.stopPropagation(),filter()}),$(".afilter > a.following").click(function(e){pf=JSON.parse(JSON.stringify(f)),$(this).toggleClass("active").find("i").toggleClass("h v");var t=!("true"==$(this).attr("data-filtered-by"));$(this).attr("data-filtered-by",t.toString()),f[$(this).attr("data-filter-type")]=t.toString(),t?$(this).attr("title",$(this).data("title-active")):$(this).attr("title",$(this).data("title")),e.preventDefault(),e.stopPropagation(),filter()}),$(".afilter > ul.afilter-list > li > a").click(function(e){pf=JSON.parse(JSON.stringify(f));var t=$(this).closest(".afilter").find("> a");$(this).closest(".afilter").find("> ul > li > a").removeClass("active"),$(this).addClass("active");var i=t.attr("data-filter-type"),n=$(this).attr("data-filter");n==t.attr("data-filter-default")?(t.find("span").text(t.is("[data-filter-default-label]")?t.attr("data-filter-default-label"):$(this).text()),t.removeClass("selected"),f[i]="",t.attr("data-filtered-by","")):(t.find("span").text($(this).text()),t.addClass("selected"),f[i]=n,t.attr("data-filtered-by",n)),e.preventDefault(),e.stopPropagation(),filter()}),$(".grid-wrapper").on("click",".pagination li:not(.active,.disabled) a",function(e){var t=$(this).attr("data-filter");f.page="1"==t?"":t,paging=!0,e.preventDefault(),e.stopPropagation(),filter()}),$(document).on("scroll DOMMouseScroll mousewheel",function(){var e=$(".pagination .next_page a").attr("href");if(e&&"#"!=e&&$(window).scrollTop()>=$(document).height()-$(window).height()-120){var t=$(".pagination .next_page a").attr("data-filter");f.page="1"==t?"":t,paging||(paging=!0,filter())}}),$(".grid-wrapper").on("click",".pagination .disabled a, .pagination .active a",function(e){e.preventDefault(),e.stopPropagation()})});